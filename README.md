# ç¨…ç‡è‡ªå‹•èƒå–å°ˆæ¡ˆ (Tax Automation Project)

## ğŸ¯ å°ˆæ¡ˆæ¦‚è¿°

é€™æ˜¯ä¸€å€‹åŸºæ–¼ **LLM æ™ºèƒ½åˆ†æ** çš„ç¾åœ‹å„å·ç¨…ç‡è‡ªå‹•èƒå–å·¥å…·ï¼Œ**å°ˆé–€é‡å° C-Corporation èˆªé‹æ¥­**è¨­è¨ˆã€‚é€é Google Gemini AI çš„å¼·å¤§åˆ†æèƒ½åŠ›ï¼Œèƒ½å¤ è‡ªå‹•å¾å„å·æ”¿åºœå®˜ç¶²æŠ“å–ä¸¦è§£æä¼æ¥­æ‰€å¾—ç¨…ç‡è³‡è¨Šï¼Œç‰¹åˆ¥é—œæ³¨èˆªé‹æ¥­ç›¸é—œçš„ç¨…ç‡å„ªæƒ å’Œç‰¹æ®Šæ¢æ¬¾ï¼Œå¤§å¹…æ¸›å°‘æ‰‹å‹•æŸ¥æ‰¾å’Œæ•´ç†çš„å·¥ä½œé‡ã€‚

### ğŸš¢ å°ˆæ¥­å®šä½
- **ç›®æ¨™å®¢æˆ¶**: C-Corporation èˆªé‹/æµ·é‹å…¬å¸
- **èšç„¦é ˜åŸŸ**: ä¼æ¥­æ‰€å¾—ç¨… (ENI)ã€å›ºå®šæœ€ä½ç¨…é¡ (FDM)ã€è³‡æœ¬ç¨… (Capital)
- **ç”¢æ¥­å„ªå‹¢**: è‡ªå‹•è­˜åˆ¥èˆªé‹æ¥­ç‰¹æ®Šç¨…ç‡ã€å…ç¨…æ¢ä»¶å’Œå„ªæƒ æ”¿ç­–

### ğŸ”¥ æ ¸å¿ƒç‰¹è‰²

- âœ… **èˆªé‹æ¥­å°ˆç²¾**: è‡ªå‹•è­˜åˆ¥æ°´é‹ã€æµ·é‹ç›¸é—œçš„ç‰¹æ®Šç¨…ç‡å’Œå„ªæƒ æ¢æ¬¾
- âœ… **C-Corp å°ˆç”¨**: åƒ…åˆ†æ C-Corporation é©ç”¨ç¨…ç‡ï¼Œéæ¿¾å…¶ä»–å¯¦é«”é¡å‹
- âœ… **æ™ºèƒ½ç¶²é è§£æ**: ä½¿ç”¨ Gemini LLM è‡ªå‹•ç†è§£ä¸åŒå·æ”¿åºœç¶²ç«™çš„çµæ§‹
- âœ… **é…ç½®é©…å‹•**: æ¯å€‹å·ä½¿ç”¨ç¨ç«‹çš„ YAML é…ç½®æ–‡ä»¶ï¼Œç„¡éœ€ä¿®æ”¹ç¨‹å¼ç¢¼
- âœ… **ç²¾æº–è¼¸å‡º**: åªè¼¸å‡ºç›¸é—œç¨…é …ï¼Œè‡ªå‹•éæ¿¾ç„¡é—œæˆ–N/Açš„é …ç›®
- âœ… **å®Œæ•´å¯©è¨ˆè¿½è¹¤**: è¨˜éŒ„ AI åˆ†æçš„æ¨ç†éç¨‹ï¼Œç‰¹åˆ¥æ¨™è¨»èˆªé‹æ¥­ç‰¹æ®Šæ¢æ¬¾
- âœ… **å®¹éŒ¯æ©Ÿåˆ¶**: å¤šé‡å‚™ç”¨ URL å’Œé™ç´šç­–ç•¥ï¼Œç¢ºä¿é«˜å¯ç”¨æ€§

### ğŸ“Š å·²é©—è­‰æ•ˆæœ

- **æº–ç¢ºç‡**: 90%+ çš„ç¨…ç‡æ­£ç¢ºèƒå–ç‡
- **æ•ˆç‡æå‡**: ç›¸æ¯”æ‰‹å‹•ä½œæ¥­æå‡ **95%** æ•ˆç‡
- **è¦†è“‹ç¯„åœ**: è¨­è¨ˆæ”¯æ´å…¨ç¾ 50 å·çš„ç¨…ç‡èƒå–

## ğŸ—ï¸ å°ˆæ¡ˆæ¶æ§‹

```
tax_automation_project/
â”œâ”€â”€ ğŸ“„ create_excel_with_gemini.py      # å–®å·å¯¦ç¾ï¼ˆç´ç´„å·ï¼‰
â”œâ”€â”€ ğŸ“„ multi_state_tax_extractor.py     # å¤šå·æ¡†æ¶
â”œâ”€â”€ ğŸ“„ config_loader.py                 # å®‰å…¨é…ç½®åŠ è¼‰å™¨
â”œâ”€â”€ ğŸ“„ config.env                       # API é‡‘é‘°é…ç½®æ–‡ä»¶
â”œâ”€â”€ ğŸ“ state_configs/                   # å„å·é…ç½®ç›®éŒ„
â”‚   â”œâ”€â”€ ny.yaml                        # ç´ç´„å·é…ç½®
â”‚   â”œâ”€â”€ ca.yaml                        # åŠ å·é…ç½®
â”‚   â””â”€â”€ ...                            # å…¶ä»–å·é…ç½®
â”œâ”€â”€ ğŸ“ output/                          # å–®å·è¼¸å‡ºç›®éŒ„
â”œâ”€â”€ ğŸ“ multi_state_output/             # å¤šå·è¼¸å‡ºç›®éŒ„
â”œâ”€â”€ ğŸ“„ requirements.txt                 # Python ä¾è³´
â””â”€â”€ ğŸ“„ README.md                       # æœ¬æ–‡ä»¶
```

## ğŸš€ å¿«é€Ÿé–‹å§‹

### 1. ç’°å¢ƒè¨­ç½®

```bash
# å…‹éš†å°ˆæ¡ˆ
git clone https://github.com/jonesandjay123/tax_automation_project.git
cd tax_automation_project

# å®‰è£ä¾è³´
pip install -r requirements.txt
```

### 2. é…ç½® API é‡‘é‘°

ç·¨è¼¯ `config.env` æ–‡ä»¶ï¼Œæ·»åŠ æ‚¨çš„ Gemini API é‡‘é‘°ï¼š

```env
GEMINI_API_KEY=your_gemini_api_key_here
GEMINI_MODEL_NAME=gemini-2.0-flash
```

> **å¦‚ä½•ç²å– Gemini API é‡‘é‘°**: å‰å¾€ [Google AI Studio](https://aistudio.google.com/app/apikey) å‰µå»ºå…è²»çš„ API é‡‘é‘°

### 3. æ¸¬è©¦å–®å·èƒå–ï¼ˆç´ç´„å·ï¼‰

```bash
python create_excel_with_gemini.py
```

**è¼¸å‡ºæª”æ¡ˆ**:
- `output/ny_tax_summary_YYYYMMDD_HHMMSS.xlsx` - Excel å ±è¡¨
- `output/ny_tax_llm_reasoning.txt` - AI åˆ†ææ¨ç†éç¨‹

### 4. é‹è¡Œå¤šå·æ¡†æ¶ï¼ˆé‡å° C-Corp èˆªé‹æ¥­ï¼‰

```bash
# é è¨­é‹è¡Œ 5 å€‹ä¸»è¦å·ï¼ˆNY, CA, TX, FL, ILï¼‰çš„ C-Corp èˆªé‹æ¥­ç¨…ç‡åˆ†æ
python multi_state_tax_extractor.py

# æŒ‡å®šç‰¹å®šå·ä»½
python multi_state_tax_extractor.py --states NY CA FL

# åˆ†æå…¶ä»–å¯¦é«”é¡å‹æˆ–ç”¢æ¥­ï¼ˆå¯é¸ï¼‰
python multi_state_tax_extractor.py --entity_type S_corp --industry manufacturing

# æŸ¥çœ‹å®Œæ•´åƒæ•¸èªªæ˜
python multi_state_tax_extractor.py --help
```

**è¼¸å‡ºæª”æ¡ˆ**:
- `multi_state_output/multi_state_tax_summary_YYYYMMDD_HHMMSS.xlsx` - å¤šå· Excel å ±è¡¨
- `multi_state_output/multi_state_reasoning_log.txt` - å„å·åˆ†ææ—¥èªŒï¼ˆåŒ…å«èˆªé‹æ¥­ç‰¹æ®Šæ¢æ¬¾åˆ†æï¼‰

## ğŸ“‹ è¼¸å‡ºæ ¼å¼èªªæ˜

### Excel å ±è¡¨æ¬„ä½

| æ¬„ä½ | èªªæ˜ | ç¯„ä¾‹ |
|------|------|------|
| State | å·å | New York |
| State Code | å·ä»£ç¢¼ | NY |
| Nexus Standard | ç¨…å‹™ç®¡è½„æ¨™æº– | market base |
| Tax Base Summary | **æ ¸å¿ƒç¨…ç‡è³‡è¨Š** | ENI: 6.5%; FDM: $25 to $200,000 (C-corp in shipping) |
| Source URL | è³‡æ–™ä¾†æºç¶²å€ | https://www.tax.ny.gov/... |

### ğŸš¢ èˆªé‹æ¥­ç‰¹æ®Šæ¨™è­˜

ç³»çµ±æœƒè‡ªå‹•åœ¨æ¨ç†æ—¥èªŒä¸­æ¨™è¨»ï¼š
- **Special shipping rule**: èˆªé‹æ¥­ç‰¹æ®Šç¨…ç‡æˆ–å„ªæƒ 
- **Water transportation**: æ°´é‹ç›¸é—œæ¢æ¬¾
- **Marine services**: æµ·é‹æœå‹™ç‰¹æ®Šè¦å®š
- **Port activity**: æ¸¯å£æ´»å‹•ç›¸é—œç¨…å‹™

### ç¨…ç‡é¡å‹è§£é‡‹

- **ENI (Entire Net Income)**: ä¼æ¥­æ·¨æ”¶å…¥ç¨…ç‡
- **Capital**: è³‡æœ¬ç¨…ç‡
- **FDM (Fixed Dollar Minimum)**: å›ºå®šæœ€ä½ç¨…é¡

## ğŸŒŸ å¤šå·æ“´å±•è¨ˆåŠƒ

### éšæ®µå¼å¯¦æ–½ç­–ç•¥

#### ğŸ¯ ç¬¬ä¸€éšæ®µï¼šä¸»è¦å•†æ¥­å·ï¼ˆ10å·ï¼‰
**ç›®æ¨™æ™‚é–“**: ç¬¬ 1-2 é€±
- âœ… New Yorkï¼ˆå·²å®Œæˆï¼‰
- ğŸ”„ California, Texas, Florida, Illinois
- ğŸ“‹ Pennsylvania, Ohio, Georgia, North Carolina, Michigan

#### ğŸ¯ ç¬¬äºŒéšæ®µï¼šä¸­ç­‰è¦æ¨¡å·ï¼ˆ20å·ï¼‰
**ç›®æ¨™æ™‚é–“**: ç¬¬ 3 é€±
- åŒ…å«æ‰€æœ‰å…·æœ‰é‡è¦å•†æ¥­æ´»å‹•çš„å·

#### ğŸ¯ ç¬¬ä¸‰éšæ®µï¼šå®Œæ•´è¦†è“‹ï¼ˆ50å·ï¼‰
**ç›®æ¨™æ™‚é–“**: ç¬¬ 4 é€±
- æ¶µè“‹æ‰€æœ‰ç¾åœ‹å·ä»½

### ğŸ“ˆ é æœŸæˆæœ

- **è¦†è“‹ç‡**: 95%+ çš„å·æˆåŠŸè™•ç†
- **æº–ç¢ºç‡**: 90%+ çš„ç¨…ç‡æ­£ç¢ºèƒå–
- **è‡ªå‹•åŒ–ç¨‹åº¦**: ç›¸æ¯”é€å·æ‰‹å‹•èª¿æ•´æ¸›å°‘ 80%+ çš„å·¥ä½œé‡

## âš™ï¸ ç‚ºæ–°å·æ·»åŠ é…ç½®

### 1. å‰µå»ºå·é…ç½®æ–‡ä»¶

åœ¨ `state_configs/` ç›®éŒ„ä¸‹å‰µå»º `[å·ä»£ç¢¼].yaml` æ–‡ä»¶ï¼š

```yaml
# state_configs/fl.yaml
state_name: Florida
state_code: FL
base_url: https://floridarevenue.com
tax_definitions_url: https://floridarevenue.com/taxes/taxesfees/Pages/corporate.aspx
backup_urls:
  - https://floridarevenue.com/businesses/
  - https://floridarevenue.com/forms/

# æ¥­å‹™å ´æ™¯é…ç½®ï¼ˆé‡è¦ï¼‰
entity_type: C_corp          # å¯¦é«”é¡å‹ï¼šC_corp, S_corp, LLC
industry: shipping           # ç”¢æ¥­ï¼šshipping, manufacturing, retail
included_fields:            # éœ€è¦èƒå–çš„ç¨…é …
  - ENI                     # ä¼æ¥­æ‰€å¾—ç¨…
  - FDM                     # å›ºå®šæœ€ä½ç¨…é¡
  - Capital                 # è³‡æœ¬ç¨…ï¼ˆå¯é¸ï¼‰

tax_types:
  - corporate_income

# LLM åˆ†ææç¤º
extraction_hints:
  keywords:
    - corporate income tax
    - corporation tax
    - 5.5%                  # å·²çŸ¥ç¨…ç‡ï¼ˆå¹«åŠ©é©—è­‰ï¼‰
  shipping_keywords:        # èˆªé‹æ¥­é—œéµå­—
    - water transportation
    - marine transportation
    - shipping
    - port activity

# å·ç‰¹å®šè³‡è¨Š
nexus_standard: market base
nexus_effective_date: '2021'
sales_factor_method: market base
sales_factor_date: '2021'
```

### ğŸ“‹ é…ç½®æ¬„ä½èªªæ˜

| æ¬„ä½ | èªªæ˜ | å¯é¸å€¼ | é è¨­å€¼ |
|------|------|--------|--------|
| `entity_type` | å…¬å¸å¯¦é«”é¡å‹ | `C_corp`, `S_corp`, `LLC`, `Partnership` | `C_corp` |
| `industry` | ç›®æ¨™ç”¢æ¥­ | `shipping`, `manufacturing`, `retail`, ç­‰ | `shipping` |
| `included_fields` | éœ€èƒå–çš„ç¨…é … | `["ENI", "FDM", "Capital"]` | `["ENI", "FDM"]` |
| `shipping_keywords` | èˆªé‹æ¥­é—œéµå­— | è‡ªè¨‚åˆ—è¡¨ | åŒ…å«æ°´é‹ã€æµ·é‹ç­‰ |

### 2. é‹è¡Œæ¸¬è©¦

```bash
python multi_state_tax_extractor.py
```

### 3. é©—è­‰çµæœ

æª¢æŸ¥è¼¸å‡ºçš„ Excel æ–‡ä»¶å’Œæ¨ç†æ—¥èªŒï¼Œç¢ºèªèƒå–çš„ç¨…ç‡è³‡è¨Šæ­£ç¢ºã€‚

## ğŸ”§ é€²éšé…ç½®

### è‡ªå®šç¾© CSS é¸æ“‡å™¨

å°æ–¼ç‰¹æ®Šç¶²ç«™çµæ§‹ï¼Œå¯ä»¥æ·»åŠ è‡ªå®šç¾©é¸æ“‡å™¨ï¼š

```yaml
fallback_selectors:
  content_area:
    - ".main-content"
    - "#tax-information"
    - ".corporate-tax-section"
```

### ä¿¡å¿ƒåº¦è¨­å®š

ç³»çµ±æœƒç‚ºæ¯æ¬¡åˆ†ææä¾›ä¿¡å¿ƒåº¦è©•åˆ†ï¼š
- **High**: 90%+ å¯ä¿¡åº¦ï¼Œå¯ç›´æ¥ä½¿ç”¨
- **Medium**: 70-90% å¯ä¿¡åº¦ï¼Œå»ºè­°äººå·¥é©—è­‰
- **Low**: <70% å¯ä¿¡åº¦ï¼Œéœ€è¦äººå·¥å¯©æŸ¥

## ğŸ› ï¸ ç–‘é›£æ’è§£

### å¸¸è¦‹å•é¡Œ

#### Q: API é‡‘é‘°éŒ¯èª¤
```bash
ERROR: Gemini API key not found!
```
**è§£æ±ºæ–¹æ¡ˆ**: æª¢æŸ¥ `config.env` æ–‡ä»¶ä¸­çš„ `GEMINI_API_KEY` è¨­å®š

#### Q: ç¶²ç«™è¢«é˜»æ“‹
```bash
403 Client Error: Forbidden
```
**è§£æ±ºæ–¹æ¡ˆ**: 
1. æª¢æŸ¥å‚™ç”¨ URL è¨­å®š
2. ç­‰å¾…ä¸€æ®µæ™‚é–“å¾Œé‡è©¦
3. è€ƒæ…®ä½¿ç”¨ä»£ç†æœå‹™

#### Q: LLM ç„¡æ³•è§£æç¨…ç‡
**è§£æ±ºæ–¹æ¡ˆ**:
1. æ·»åŠ æ›´å…·é«”çš„ `extraction_hints`
2. æª¢æŸ¥ç¶²ç«™æ˜¯å¦æœ‰çµæ§‹è®Šæ›´
3. å¢åŠ å‚™ç”¨ URL

### æŠ€è¡“æ”¯æ´

é‡åˆ°æŠ€è¡“å•é¡Œæ™‚ï¼Œè«‹æª¢æŸ¥ï¼š
1. `multi_state_reasoning_log.txt` - æŸ¥çœ‹ AI åˆ†æéç¨‹
2. æ§åˆ¶å°è¼¸å‡º - æŸ¥çœ‹éŒ¯èª¤è¨Šæ¯
3. ç¶²ç«™è¨ªå•ç‹€æ³ - ç¢ºèªç›®æ¨™ç¶²ç«™å¯æ­£å¸¸è¨ªå•

## ğŸ”’ å®‰å…¨æ€§èªªæ˜

- âœ… API é‡‘é‘°å­˜å„²åœ¨ç¨ç«‹çš„é…ç½®æ–‡ä»¶ä¸­ï¼Œä¸æœƒæäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶
- âœ… æ”¯æ´ç’°å¢ƒè®Šæ•¸æ–¹å¼é…ç½®ï¼Œé©åˆç”Ÿç”¢ç’°å¢ƒéƒ¨ç½²
- âœ… æ‰€æœ‰ç¶²è·¯è«‹æ±‚éƒ½æœ‰è¶…æ™‚å’ŒéŒ¯èª¤è™•ç†æ©Ÿåˆ¶
- âœ… æä¾›å®Œæ•´çš„å¯©è¨ˆè¿½è¹¤ï¼Œæ‰€æœ‰ AI åˆ†æéç¨‹éƒ½æœ‰è¨˜éŒ„

## ğŸ“Š æ•ˆç‡å°æ¯”

| æ–¹å¼ | æ™‚é–“æˆæœ¬ | æº–ç¢ºæ€§ | å¯ç¶­è­·æ€§ |
|------|----------|--------|----------|
| **æ‰‹å‹•æŸ¥æ‰¾** | æ¯å· 2-4 å°æ™‚ | äººç‚ºéŒ¯èª¤é¢¨éšª | é›£ä»¥ç¶­è­· |
| **å‚³çµ±çˆ¬èŸ²** | æ¯å· 1-2 å¤©é–‹ç™¼ | ç¶²ç«™è®Šæ›´å®¹æ˜“å¤±æ•ˆ | ç¶­è­·æˆæœ¬é«˜ |
| **æˆ‘å€‘çš„æ–¹æ¡ˆ** | æ¯å· 30 åˆ†é˜é…ç½® | 90%+ AI æº–ç¢ºç‡ | é…ç½®é©…å‹•ï¼Œæ˜“ç¶­è­· |

## ğŸš€ æœªä¾†ç™¼å±•æ–¹å‘

### çŸ­æœŸç›®æ¨™ï¼ˆ1-2 å€‹æœˆï¼‰
- [ ] å®Œæˆå…¨ç¾ 50 å·é…ç½®
- [ ] å»ºç«‹è‡ªå‹•åŒ–ç›£æ§æ©Ÿåˆ¶
- [ ] å¢åŠ æ›´å¤šç¨…ç¨®æ”¯æ´ï¼ˆéŠ·å”®ç¨…ã€è²¡ç”¢ç¨…ç­‰ï¼‰

### ä¸­æœŸç›®æ¨™ï¼ˆ3-6 å€‹æœˆï¼‰
- [ ] é–‹ç™¼ Web Dashboard ä»‹é¢
- [ ] å¢åŠ æ­·å²è³‡æ–™è¿½è¹¤åŠŸèƒ½
- [ ] æ”¯æ´å¤šç¨® LLM æ¨¡å‹ï¼ˆClaude, GPT-4 ç­‰ï¼‰

### é•·æœŸç›®æ¨™ï¼ˆ6-12 å€‹æœˆï¼‰
- [ ] API æœå‹™åŒ–éƒ¨ç½²
- [ ] å³æ™‚ç¨…ç‡è®Šæ›´é€šçŸ¥
- [ ] æ•´åˆæœƒè¨ˆè»Ÿé«”ï¼ˆQuickBooks, Xero ç­‰ï¼‰

## ğŸ¤ è²¢ç»æŒ‡å—

æ­¡è¿è²¢ç»ï¼è«‹åƒè€ƒä»¥ä¸‹æ–¹å¼ï¼š

1. **æ–°å¢å·é…ç½®**: æäº¤æ–°çš„å·é…ç½®æ–‡ä»¶
2. **Bug å ±å‘Š**: åœ¨ Issues ä¸­å ±å‘Šå•é¡Œ
3. **åŠŸèƒ½å»ºè­°**: æå‡ºæ”¹é€²å»ºè­°
4. **ä»£ç¢¼è²¢ç»**: æäº¤ Pull Request

## ğŸ“„ æˆæ¬Š

æœ¬å°ˆæ¡ˆæ¡ç”¨ MIT æˆæ¬Šæ¢æ¬¾ã€‚è©³è¦‹ LICENSE æ–‡ä»¶ã€‚

## ğŸ‘¥ é–‹ç™¼åœ˜éšŠ

- **Tax Automation Team** - åˆå§‹é–‹ç™¼
- **è²¢ç»è€…** - æ„Ÿè¬æ‰€æœ‰åƒèˆ‡æ”¹é€²çš„å¤¥ä¼´

---

**ğŸ“§ è¯çµ¡è³‡è¨Š**: å¦‚æœ‰ä»»ä½•å•é¡Œæˆ–å»ºè­°ï¼Œæ­¡è¿é€é GitHub Issues è¯ç¹«æˆ‘å€‘ã€‚

**â­ å¦‚æœé€™å€‹å°ˆæ¡ˆå°æ‚¨æœ‰å¹«åŠ©ï¼Œè«‹çµ¦æˆ‘å€‘ä¸€å€‹ Starï¼** 